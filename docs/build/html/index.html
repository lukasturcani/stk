

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Welcome to stk’s documentation! &mdash; stk  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> stk
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Welcome to <code class="docutils literal notranslate"><span class="pre">stk</span></code>’s documentation!</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#basic-examples">Basic Examples</a><ul>
<li><a class="reference internal" href="#linear-polymer">Linear Polymer</a></li>
<li><a class="reference internal" href="#molecular-cages">Molecular Cages</a></li>
<li><a class="reference internal" href="#covalent-organic-frameworks">Covalent Organic Frameworks</a></li>
<li><a class="reference internal" href="#other-materials">Other Materials</a></li>
</ul>
</li>
<li><a class="reference internal" href="#calculators">Calculators</a><ul>
<li><a class="reference internal" href="#combining-calculators">Combining Calculators</a></li>
<li><a class="reference internal" href="#making-new-calculators">Making New Calculators</a></li>
<li><a class="reference internal" href="#saving-calculator-results">Saving Calculator Results</a></li>
<li><a class="reference internal" href="#calculating-molecular-properties">Calculating Molecular Properties</a></li>
<li><a class="reference internal" href="#geometric-manipulations">Geometric Manipulations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dealing-with-multiple-conformers">Dealing with Multiple Conformers</a><ul>
<li><a class="reference internal" href="#dealing-with-multiple-molecules">Dealing with Multiple Molecules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#automated-molecular-design-with-genetic-algorithms">Automated Molecular Design with Genetic Algorithms</a><ul>
<li><a class="reference internal" href="#genetic-algorithm-input-file-variables">Genetic algorithm input file variables.</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extending-stk">Extending <code class="docutils literal notranslate"><span class="pre">stk</span></code></a></li>
<li><a class="reference internal" href="#further-reading">Further Reading</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">stk</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li>Welcome to <code class="docutils literal notranslate"><span class="pre">stk</span></code>’s documentation!</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="welcome-to-stk-s-documentation">
<h1>Welcome to <code class="docutils literal notranslate"><span class="pre">stk</span></code>’s documentation!<a class="headerlink" href="#welcome-to-stk-s-documentation" title="Permalink to this headline">¶</a></h1>
<p>GitHub: <a class="reference external" href="https://www.github.com/lukasturcani/stk">https://www.github.com/lukasturcani/stk</a></p>
<p>Slack: <a class="reference external" href="https://t.co/LCPzWhvsVO">https://t.co/LCPzWhvsVO</a></p>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">stk</span></code> is a Python library for building, manipulating, analyzing and
automatic design of molecules, including a genetic algorithm.</p>
<p>For quick navigation through the modules use <a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a>.
For a closer look at the genetic algorithm, start with
<a class="reference internal" href="#automated-molecular-design-with-genetic-algorithms">Automated Molecular Design with Genetic Algorithms</a>.</p>
</div>
<div class="section" id="basic-examples">
<h2>Basic Examples<a class="headerlink" href="#basic-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="linear-polymer">
<h3>Linear Polymer<a class="headerlink" href="#linear-polymer" title="Permalink to this headline">¶</a></h3>
<p>The core function of <code class="docutils literal notranslate"><span class="pre">stk</span></code> is to assemble molecules. Here is an example
of how a simple, linear polymer can be built. Starting with three monomers,
such as</p>
<img alt="_images/monomers.png" src="_images/monomers.png" />
<p>each can be loaded into a <a class="reference internal" href="stk.molecular.molecules.struct_unit.html#stk.molecular.molecules.struct_unit.StructUnit2" title="stk.molecular.molecules.struct_unit.StructUnit2"><code class="xref py py-class docutils literal notranslate"><span class="pre">StructUnit2</span></code></a> object from a molecular
structure file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">monomer1</span> <span class="o">=</span> <span class="n">StructUnit2</span><span class="p">(</span><span class="s1">&#39;monomer1.mol&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bromine&#39;</span><span class="p">])</span>
<span class="n">monomer2</span> <span class="o">=</span> <span class="n">StructUnit2</span><span class="p">(</span><span class="s1">&#39;monomer2.mol&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bromine&#39;</span><span class="p">])</span>
<span class="n">monomer3</span> <span class="o">=</span> <span class="n">StructUnit2</span><span class="p">(</span><span class="s1">&#39;monomer3.mol&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bromine&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The first argument is the path to the structure file and the second
argument specifies the reactive functional groups of the monomer.</p>
<p>To assemble a polymer only a single line of code is required:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">polymer</span> <span class="o">=</span> <span class="n">Polymer</span><span class="p">([</span><span class="n">monomer1</span><span class="p">,</span> <span class="n">monomer2</span><span class="p">,</span> <span class="n">monomer3</span><span class="p">],</span> <span class="n">Linear</span><span class="p">(</span><span class="s1">&#39;ABC&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
<p>Simply create a <a class="reference internal" href="stk.molecular.molecules.polymer.html#stk.molecular.molecules.polymer.Polymer" title="stk.molecular.molecules.polymer.Polymer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Polymer</span></code></a> object by giving it a list of
monomers and a topology object, in this
case <a class="reference internal" href="stk.molecular.topologies.polymer.html#stk.molecular.topologies.polymer.Linear" title="stk.molecular.topologies.polymer.Linear"><code class="xref py py-class docutils literal notranslate"><span class="pre">Linear</span></code></a>. The topology object defines the the structure of
the polymer being assembled. The repeating unit is <code class="docutils literal notranslate"><span class="pre">'ABC'</span></code>, the orientation
of the each monomer along the chain is parallel, anti-parallel and random, respectively, and
the number of repeating units is <code class="docutils literal notranslate"><span class="pre">3</span></code>.</p>
<p>The assembled polymer can be written to a file</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">polymer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;polymer.mol&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>and will look like this.</p>
<img alt="_images/polymer.png" src="_images/polymer.png" />
<p>Notice that the functional group has disappeared and been replaced by
new bonds between the monomers. The new bonds seem a little stretched,
so we can optimize the structure using an <a class="reference internal" href="stk.calculators.optimization.optimizers.html#stk.calculators.optimization.optimizers.Optimizer" title="stk.calculators.optimization.optimizers.Optimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Optimizer</span></code></a>
defined in <code class="xref py py-mod docutils literal notranslate"><span class="pre">optimization</span></code>, in this case
<a class="reference internal" href="stk.calculators.optimization.optimizers.html#stk.calculators.optimization.optimizers.MMFF" title="stk.calculators.optimization.optimizers.MMFF"><code class="xref py py-class docutils literal notranslate"><span class="pre">MMFF</span></code></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mmff</span> <span class="o">=</span> <span class="n">MMFF</span><span class="p">()</span>
<span class="n">mmff</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">polymer</span><span class="p">)</span>
</pre></div>
</div>
<p>Again, the polymer can be written to a file</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">polymer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;polymer_opt.mol&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>and viewed</p>
<img alt="_images/polymer_opt.png" src="_images/polymer_opt.png" />
<p><code class="docutils literal notranslate"><span class="pre">stk</span></code> also allows you to save the Python objects themselves in the JSON
format.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">polymer</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;polymer.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This allows you to restore a <a class="reference internal" href="stk.molecular.molecules.molecule.html#stk.molecular.molecules.molecule.Molecule" title="stk.molecular.molecules.molecule.Molecule"><code class="xref py py-class docutils literal notranslate"><span class="pre">Molecule</span></code></a> object from a previous session.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">polymer</span> <span class="o">=</span> <span class="n">Molecule</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;polymer.json&#39;</span><span class="p">)</span>
<span class="n">polymer</span> <span class="c1"># &lt; Polymer NOT Molecule object &gt;</span>
</pre></div>
</div>
<p><a class="reference internal" href="stk.molecular.molecules.molecule.html#stk.molecular.molecules.molecule.Molecule.load" title="stk.molecular.molecules.molecule.Molecule.load"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Molecule.load()</span></code></a> allows you to load any dumped <code class="docutils literal notranslate"><span class="pre">stk</span></code> JSON object
regardless of its class and it will returned an object of the correct
class to you.</p>
</div>
<div class="section" id="molecular-cages">
<h3>Molecular Cages<a class="headerlink" href="#molecular-cages" title="Permalink to this headline">¶</a></h3>
<p>Molecular cages are relatively
exotic molecules that look like, yes, cages. Here is an example:</p>
<img alt="_images/molecular_cage.png" src="_images/molecular_cage.png" />
<p>Despite their apparent complexity, assembling a molecular cage is
extremely straightforward. In fact, it is done in exactly the same way
as a polymer.</p>
<p>First we define the building blocks of the cage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bb1</span> <span class="o">=</span> <span class="n">StructUnit2</span><span class="p">(</span><span class="s1">&#39;bb1.mol&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;amine&#39;</span><span class="p">])</span>
<span class="n">bb2</span> <span class="o">=</span> <span class="n">StructUnit3</span><span class="p">(</span><span class="s1">&#39;bb2.mol&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aldehyde&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Here is what they look like:</p>
<img alt="_images/cage_building_blocks.png" src="_images/cage_building_blocks.png" />
<p>Notice a slight difference, while the first building building block still
uses the class <a class="reference internal" href="stk.molecular.molecules.struct_unit.html#stk.molecular.molecules.struct_unit.StructUnit2" title="stk.molecular.molecules.struct_unit.StructUnit2"><code class="xref py py-class docutils literal notranslate"><span class="pre">StructUnit2</span></code></a>, the second uses the class
<a class="reference internal" href="stk.molecular.molecules.struct_unit.html#stk.molecular.molecules.struct_unit.StructUnit3" title="stk.molecular.molecules.struct_unit.StructUnit3"><code class="xref py py-class docutils literal notranslate"><span class="pre">StructUnit3</span></code></a>. The reason is that the first building block has
2 functional groups while the second has 3 functional groups. Each class
defines a slightly different set of operations for manipulating the
positions of the building blocks when assembling the cage. This is
important so that the building blocks are placed exactly how we want them
when constructing a molecule. However, all of this happens behind the scenes
and a cage can be constructed through a simple one-liner:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cage</span> <span class="o">=</span> <span class="n">Cage</span><span class="p">([</span><span class="n">bb1</span><span class="p">,</span> <span class="n">bb2</span><span class="p">],</span> <span class="n">FourPlusSix</span><span class="p">())</span>
</pre></div>
</div>
<p>Notice that this is exactly the same as the polymer example. To generate
a cage, we simply create a <a class="reference internal" href="stk.molecular.molecules.cage.html#stk.molecular.molecules.cage.Cage" title="stk.molecular.molecules.cage.Cage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cage</span></code></a> object. We initialize it with
a list of building blocks and provide a topology instance, in this case
<a class="reference internal" href="stk.molecular.topologies.cage.two_plus_three.html#stk.molecular.topologies.cage.two_plus_three.FourPlusSix" title="stk.molecular.topologies.cage.two_plus_three.FourPlusSix"><code class="xref py py-class docutils literal notranslate"><span class="pre">FourPlusSix</span></code></a>. Unlike the <a class="reference internal" href="stk.molecular.topologies.polymer.html#stk.molecular.topologies.polymer.Linear" title="stk.molecular.topologies.polymer.Linear"><code class="xref py py-class docutils literal notranslate"><span class="pre">Linear</span></code></a> class, the <a class="reference internal" href="stk.molecular.topologies.cage.two_plus_three.html#stk.molecular.topologies.cage.two_plus_three.FourPlusSix" title="stk.molecular.topologies.cage.two_plus_three.FourPlusSix"><code class="xref py py-class docutils literal notranslate"><span class="pre">FourPlusSix</span></code></a>
does not require any additional arguments. Our assembled cage looks like
this</p>
<img alt="_images/cage.png" src="_images/cage.png" />
<p>If we want to create a cage with a different topology but using the same
building blocks, we provide a different topology instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cage2</span> <span class="o">=</span> <span class="n">Cage</span><span class="p">([</span><span class="n">bb1</span><span class="p">,</span> <span class="n">bb2</span><span class="p">],</span> <span class="n">EightPlusTwelve</span><span class="p">())</span>
</pre></div>
</div>
<p>The assembled cage looks like a cube:</p>
<img alt="_images/cage2.png" src="_images/cage2.png" />
<p>Notice that the building blocks are the same, only the shape has changed.
This is because a different topology instance was provided during initialization.</p>
<p>Here is a third example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cage3</span> <span class="o">=</span> <span class="n">Cage</span><span class="p">([</span><span class="n">bb1</span><span class="p">,</span> <span class="n">bb2</span><span class="p">],</span> <span class="n">Dodecahedron</span><span class="p">())</span>
</pre></div>
</div>
<img alt="_images/cage3.png" src="_images/cage3.png" />
<p>While we assembled some cages, the constructed structures are not
particularly realistic. We can optimize the geometry using an
<a class="reference internal" href="stk.calculators.optimization.optimizers.html#stk.calculators.optimization.optimizers.Optimizer" title="stk.calculators.optimization.optimizers.Optimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Optimizer</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">macromodel</span> <span class="o">=</span> <span class="n">MacroModelForceField</span><span class="p">(</span>
    <span class="n">macromodel_path</span><span class="o">=</span><span class="s1">&#39;/opt/schrodinger2017-4&#39;</span>
<span class="p">)</span>
<span class="n">macromodel</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">cage</span><span class="p">)</span>
<span class="n">macromodel</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">cage2</span><span class="p">)</span>
<span class="n">macromodel</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">cage3</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/cages_opt.png" src="_images/cages_opt.png" />
<p>In this case the optimizer <a class="reference internal" href="stk.calculators.optimization.macromodel.html#stk.calculators.optimization.macromodel.MacroModelForceField" title="stk.calculators.optimization.macromodel.MacroModelForceField"><code class="xref py py-class docutils literal notranslate"><span class="pre">MacroModelForceField</span></code></a> was used.
We could have used <a class="reference internal" href="stk.calculators.optimization.optimizers.html#stk.calculators.optimization.optimizers.MMFF" title="stk.calculators.optimization.optimizers.MMFF"><code class="xref py py-class docutils literal notranslate"><span class="pre">MMFF</span></code></a> again but chances are the structures
would have been optimized quite poorly. The
<a class="reference internal" href="stk.calculators.optimization.macromodel.html#stk.calculators.optimization.macromodel.MacroModelForceField" title="stk.calculators.optimization.macromodel.MacroModelForceField"><code class="xref py py-class docutils literal notranslate"><span class="pre">MacroModelForceField</span></code></a> optimizer
requires a valid <code class="docutils literal notranslate"><span class="pre">MacroModel</span></code> installation with a working license.
The argument <code class="docutils literal notranslate"><span class="pre">'/opt/schrodinger2017-4'</span></code> is the path to the installation.</p>
<p>Note that there are many more cage topologies available (14+), which
can be found by looking in <a class="reference internal" href="stk.molecular.topologies.cage.html#module-stk.molecular.topologies.cage" title="stk.molecular.topologies.cage"><code class="xref py py-mod docutils literal notranslate"><span class="pre">stk.molecular.topologies.cage</span></code></a>.</p>
<img alt="_images/cages_two_plus_three.png" src="_images/cages_two_plus_three.png" />
<img alt="_images/cages_two_plus_four.png" src="_images/cages_two_plus_four.png" />
<img alt="_images/cages_three_plus_four.png" src="_images/cages_three_plus_four.png" />
<img alt="_images/cages_three_plus_three.png" src="_images/cages_three_plus_three.png" />
<p>The topologies are organized into submodules based on the building blocks
required to build them. For example, all topologies in the
<a class="reference internal" href="stk.molecular.topologies.cage.two_plus_three.html#module-stk.molecular.topologies.cage.two_plus_three" title="stk.molecular.topologies.cage.two_plus_three"><code class="xref py py-mod docutils literal notranslate"><span class="pre">stk.molecular.topologies.cage.two_plus_three</span></code></a> submodule are composed of two and three functionalized building
blocks, all cages in the <a class="reference internal" href="stk.molecular.topologies.cage.two_plus_four.html#module-stk.molecular.topologies.cage.two_plus_four" title="stk.molecular.topologies.cage.two_plus_four"><code class="xref py py-mod docutils literal notranslate"><span class="pre">stk.molecular.topologies.cage.two_plus_four</span></code></a> submodule are composed of two and
four functionalized building blocks, cages in <a class="reference internal" href="stk.molecular.topologies.cage.three_plus_three.html#module-stk.molecular.topologies.cage.three_plus_three" title="stk.molecular.topologies.cage.three_plus_three"><code class="xref py py-mod docutils literal notranslate"><span class="pre">stk.molecular.topologies.cage.three_plus_three</span></code></a> are composed
of three functionalized building blocks and so on.</p>
<p>All cage topologies also support being built from more than two building
blocks, to produce mixed or multi-component cages.</p>
<img alt="_images/multi_cage.png" src="_images/multi_cage.png" />
<p>In addition, cage topologies support a number of optional arguments which allow the many
possible structural isomers to be easily assembled. These topics are
discussed in <a class="reference internal" href="advanced_cage_building.html"><span class="doc">Advanced Cage Building</span></a>.</p>
</div>
<div class="section" id="covalent-organic-frameworks">
<h3>Covalent Organic Frameworks<a class="headerlink" href="#covalent-organic-frameworks" title="Permalink to this headline">¶</a></h3>
<p>Just like the other molecules, covalent organic frameworks (COFs) are easy to
construct:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bb1</span> <span class="o">=</span> <span class="n">StructUnit2</span><span class="p">(</span><span class="s1">&#39;cof_bb1.mol&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;amine&#39;</span><span class="p">])</span>
<span class="n">bb2</span> <span class="o">=</span> <span class="n">StructUnit3</span><span class="p">(</span><span class="s1">&#39;cof_bb2.mol&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aldehyde&#39;</span><span class="p">]))</span>
<span class="n">cof</span> <span class="o">=</span> <span class="n">Periodic</span><span class="p">([</span><span class="n">bb1</span><span class="p">,</span> <span class="n">bb2</span><span class="p">],</span> <span class="n">Honeycomb</span><span class="p">())</span>
</pre></div>
</div>
<p>Where the buliding blocks are:</p>
<img alt="_images/cof_bbs.png" src="_images/cof_bbs.png" />
<p>The same pattern is used. First building blocks objects are created using
<a class="reference internal" href="stk.molecular.molecules.struct_unit.html#stk.molecular.molecules.struct_unit.StructUnit3" title="stk.molecular.molecules.struct_unit.StructUnit3"><code class="xref py py-class docutils literal notranslate"><span class="pre">StructUnit3</span></code></a> instances. Then a molecule is assembled by creating
an instance of its class, in this case <a class="reference internal" href="stk.molecular.molecules.periodic.html#stk.molecular.molecules.periodic.Periodic" title="stk.molecular.molecules.periodic.Periodic"><code class="xref py py-class docutils literal notranslate"><span class="pre">Periodic</span></code></a>. The molecule
being assembled is provided with the building blocks and the topology,
in this case <a class="reference internal" href="stk.molecular.topologies.cof.html#stk.molecular.topologies.cof.Honeycomb" title="stk.molecular.topologies.cof.Honeycomb"><code class="xref py py-class docutils literal notranslate"><span class="pre">Honeycomb</span></code></a>.</p>
<p>Because COFs are periodic structures, if we want to make a finite size
molecule we have to create an “island”:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cof</span><span class="o">.</span><span class="n">island</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>Here we created create a 5 by 5 by 1 grid of the periodic unit cell.
This is a cut-out of our structure:</p>
<img alt="_images/honey.png" src="_images/honey.png" />
<p>Other COF topologies are available in <a class="reference internal" href="stk.molecular.topologies.cof.html#module-stk.molecular.topologies.cof" title="stk.molecular.topologies.cof"><code class="xref py py-mod docutils literal notranslate"><span class="pre">topologies.cof</span></code></a>. For example:</p>
<p><a class="reference internal" href="stk.molecular.topologies.cof.html#stk.molecular.topologies.cof.Hexagonal" title="stk.molecular.topologies.cof.Hexagonal"><code class="xref py py-class docutils literal notranslate"><span class="pre">Hexagonal</span></code></a></p>
<img alt="_images/hex.png" src="_images/hex.png" />
<p><a class="reference internal" href="stk.molecular.topologies.cof.html#stk.molecular.topologies.cof.Square" title="stk.molecular.topologies.cof.Square"><code class="xref py py-class docutils literal notranslate"><span class="pre">Square</span></code></a></p>
<img alt="_images/square.png" src="_images/square.png" />
<p><a class="reference internal" href="stk.molecular.topologies.cof.html#stk.molecular.topologies.cof.Kagome" title="stk.molecular.topologies.cof.Kagome"><code class="xref py py-class docutils literal notranslate"><span class="pre">Kagome</span></code></a></p>
<img alt="_images/kagome.png" src="_images/kagome.png" />
<p><code class="docutils literal notranslate"><span class="pre">stk</span></code> also gives tools to build a large number of structural isomers
of each COF. This is done analogously to the organic cage case so reading
<a class="reference internal" href="advanced_cage_building.html"><span class="doc">Advanced Cage Building</span></a> is recommended.</p>
</div>
<div class="section" id="other-materials">
<h3>Other Materials<a class="headerlink" href="#other-materials" title="Permalink to this headline">¶</a></h3>
<p>Other materials defined by <code class="docutils literal notranslate"><span class="pre">stk</span></code> can be found in
<a class="reference internal" href="stk.molecular.topologies.html#module-stk.molecular.topologies" title="stk.molecular.topologies"><code class="xref py py-mod docutils literal notranslate"><span class="pre">molecular.topologies</span></code></a>. In addition to this, <code class="docutils literal notranslate"><span class="pre">stk</span></code> was designed
to be easy extend to other classes of molecules. For a guide on how this
can be done see, <a class="reference internal" href="#extending-stk"><span class="std std-ref">Extending stk</span></a>.</p>
</div>
</div>
<div class="section" id="calculators">
<h2>Calculators<a class="headerlink" href="#calculators" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">stk</span></code> makes extensive use of calculator objects. Calculators are a
very general pattern for performing operations on molecules. All
calculators are objects with a special method, used to perform the
calculation. You have already been introduced to one type of calculator,
the <a class="reference internal" href="stk.calculators.optimization.optimizers.html#stk.calculators.optimization.optimizers.Optimizer" title="stk.calculators.optimization.optimizers.Optimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Optimizer</span></code></a>. An optimizer has a special method called
<a class="reference internal" href="stk.calculators.optimization.optimizers.html#stk.calculators.optimization.optimizers.Optimizer.optimize" title="stk.calculators.optimization.optimizers.Optimizer.optimize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">optimize()</span></code></a>, which optimizes a molecule. Here is
another example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mol</span> <span class="o">=</span> <span class="n">StructUnit</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">polymer</span> <span class="o">=</span> <span class="n">Polymer</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">optimizer1</span> <span class="o">=</span> <span class="n">MMFF</span><span class="p">()</span>

<span class="c1"># Optimize mol with mmff.</span>
<span class="n">optimizer1</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="c1"># Optimize polymer conformer 2 with mmff.</span>
<span class="n">optimizer2</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">polymer</span><span class="p">,</span> <span class="n">conformer</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Other types of calculators will have different special methods used to
perform calculations on molecules. For example, an
<a class="reference internal" href="stk.calculators.energy.energy_calculators.html#stk.calculators.energy.energy_calculators.EnergyCalculator" title="stk.calculators.energy.energy_calculators.EnergyCalculator"><code class="xref py py-class docutils literal notranslate"><span class="pre">EnergyCalculator</span></code></a> will define an
<a class="reference internal" href="stk.calculators.energy.energy_calculators.html#stk.calculators.energy.energy_calculators.EnergyCalculator.energy" title="stk.calculators.energy.energy_calculators.EnergyCalculator.energy"><code class="xref py py-meth docutils literal notranslate"><span class="pre">energy()</span></code></a> method. This method calculates the
energy of the molecule</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mmff_energy</span> <span class="o">=</span> <span class="n">MMFFEnergy</span><span class="p">()</span>
<span class="n">uff_energy</span> <span class="o">=</span> <span class="n">UFFEnergy</span><span class="p">()</span>

<span class="c1"># Calculate the energy of mol conformer 1 with the mmff force field.</span>
<span class="n">mol_mmff_energy</span> <span class="o">=</span> <span class="n">mmff_energy</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">conformer</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Calculate the energy of polymer conformer 10 with the uff force field.</span>
<span class="n">polymer_uff_energy</span> <span class="o">=</span> <span class="n">uff_energy</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">polymer</span><span class="p">,</span> <span class="n">conformer</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>All genetic algorithm operations are also implemented through
calculators, take for example a <a class="reference internal" href="stk.calculators.ga.mutators.html#stk.calculators.ga.mutators.Mutator" title="stk.calculators.ga.mutators.Mutator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mutator</span></code></a> such as
<a class="reference internal" href="stk.calculators.ga.mutators.html#stk.calculators.ga.mutators.RandomTopology" title="stk.calculators.ga.mutators.RandomTopology"><code class="xref py py-class docutils literal notranslate"><span class="pre">RandomTopology</span></code></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">topologies</span> <span class="o">=</span> <span class="p">[</span><span class="n">EightPlusTwelve</span><span class="p">(),</span> <span class="n">FourPlusSix</span><span class="p">(),</span> <span class="n">Dodecahedron</span><span class="p">()]</span>
<span class="n">random_top</span> <span class="o">=</span> <span class="n">RandomTopology</span><span class="p">(</span><span class="n">topologies</span><span class="p">)</span>

<span class="c1"># Assume bb1 and bb2 are StructUnit2 and StructUnit3 objects.</span>
<span class="n">cage</span> <span class="o">=</span> <span class="n">Cage</span><span class="p">([</span><span class="n">bb1</span><span class="p">,</span> <span class="n">bb2</span><span class="p">],</span> <span class="n">SixPlusNine</span><span class="p">())</span>

<span class="c1"># Perform a mutation.</span>
<span class="n">mutant</span> <span class="o">=</span> <span class="n">random_top</span><span class="o">.</span><span class="n">mutate</span><span class="p">(</span><span class="n">cage</span><span class="p">)</span>
</pre></div>
</div>
<p>A <a class="reference internal" href="stk.calculators.ga.mutators.html#stk.calculators.ga.mutators.Mutator" title="stk.calculators.ga.mutators.Mutator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mutator</span></code></a> is a calculator which implements a
<a class="reference internal" href="stk.calculators.ga.mutators.html#stk.calculators.ga.mutators.Mutator.mutate" title="stk.calculators.ga.mutators.Mutator.mutate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mutate()</span></code></a> method. This method takes a molecule and
returns a mutant, <em>i.e.</em> a modified version, of that molecule.
In this example, the <code class="docutils literal notranslate"><span class="pre">random_top</span></code> is a <a class="reference internal" href="stk.calculators.ga.mutators.html#stk.calculators.ga.mutators.Mutator" title="stk.calculators.ga.mutators.Mutator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mutator</span></code></a>, which replaces
the topology of a molecule with a new one, in order to generate the mutant.
In this case, the new topologies would be one of <a class="reference internal" href="stk.molecular.topologies.cage.two_plus_three.html#stk.molecular.topologies.cage.two_plus_three.EightPlusTwelve" title="stk.molecular.topologies.cage.two_plus_three.EightPlusTwelve"><code class="xref py py-class docutils literal notranslate"><span class="pre">EightPlusTwelve</span></code></a>,
<a class="reference internal" href="stk.molecular.topologies.cage.two_plus_three.html#stk.molecular.topologies.cage.two_plus_three.FourPlusSix" title="stk.molecular.topologies.cage.two_plus_three.FourPlusSix"><code class="xref py py-class docutils literal notranslate"><span class="pre">FourPlusSix</span></code></a> or <a class="reference internal" href="stk.molecular.topologies.cage.two_plus_three.html#stk.molecular.topologies.cage.two_plus_three.Dodecahedron" title="stk.molecular.topologies.cage.two_plus_three.Dodecahedron"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dodecahedron</span></code></a>.</p>
<p>Calculators often support additional options to modify their behaviour.
For example, calculators of type <a class="reference internal" href="stk.calculators.optimization.optimizers.html#stk.calculators.optimization.optimizers.Optimizer" title="stk.calculators.optimization.optimizers.Optimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Optimizer</span></code></a> or
<a class="reference internal" href="stk.calculators.energy.energy_calculators.html#stk.calculators.energy.energy_calculators.EnergyCalculator" title="stk.calculators.energy.energy_calculators.EnergyCalculator"><code class="xref py py-class docutils literal notranslate"><span class="pre">EnergyCalculator</span></code></a> support caching. This means that if the
same molecule and conformer is supplied to the calculator, it will not
run the optimization or energy calculation again, it will return the
previously calculated value</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example of caching with optimizers.</span>
<span class="n">mmff</span> <span class="o">=</span> <span class="n">MMFF</span><span class="p">()</span>
<span class="n">caching_mmff</span> <span class="o">=</span> <span class="n">MMFF</span><span class="p">(</span><span class="n">use_cache</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">StructUnit</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Performs an optimization on mol.</span>
<span class="n">mmff</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="c1"># Performs a second optimization on mol.</span>
<span class="n">mmff</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

<span class="c1"># Performs an optimization on mol.</span>
<span class="n">cached_mmff</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="c1"># Does not peform an optimization on mol.</span>
<span class="n">cached_mmff</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

<span class="c1"># Make a non-caching and a caching uff energy calculator.</span>
<span class="n">uff_energy</span> <span class="o">=</span> <span class="n">UFFEnergy</span><span class="p">()</span>
<span class="n">caching_uff_energy</span> <span class="o">=</span> <span class="n">UFFEnergy</span><span class="p">(</span><span class="n">use_cache</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Calculate the energy twice.</span>
<span class="n">uff_energy</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">uff_energy</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

<span class="c1"># Calculate the energy.</span>
<span class="n">caching_uff_energy</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="c1"># Does not calculate the energy again, returns the previous value.</span>
<span class="n">caching_uff_energy</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
</pre></div>
</div>
<p>More information on each type of calculator can be seen by visiting the
following modules:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="stk.calculators.optimization.html#module-stk.calculators.optimization" title="stk.calculators.optimization"><code class="xref py py-mod docutils literal notranslate"><span class="pre">optimization</span></code></a></li>
<li><a class="reference internal" href="stk.calculators.energy.html#module-stk.calculators.energy" title="stk.calculators.energy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">energy</span></code></a></li>
<li><a class="reference internal" href="stk.calculators.electronic_property.html#module-stk.calculators.electronic_property" title="stk.calculators.electronic_property"><code class="xref py py-mod docutils literal notranslate"><span class="pre">electronic_property</span></code></a></li>
<li><a class="reference internal" href="stk.calculators.ga.mutators.html#module-stk.calculators.ga.mutators" title="stk.calculators.ga.mutators"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mutators</span></code></a></li>
<li><a class="reference internal" href="stk.calculators.ga.crossers.html#module-stk.calculators.ga.crossers" title="stk.calculators.ga.crossers"><code class="xref py py-mod docutils literal notranslate"><span class="pre">crossers</span></code></a></li>
<li><a class="reference internal" href="stk.calculators.ga.fitness_calculators.html#module-stk.calculators.ga.fitness_calculators" title="stk.calculators.ga.fitness_calculators"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fitness_calculators</span></code></a></li>
<li><a class="reference internal" href="stk.calculators.ga.fitness_normalizers.html#module-stk.calculators.ga.fitness_normalizers" title="stk.calculators.ga.fitness_normalizers"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fitness_normalizers</span></code></a></li>
<li><a class="reference internal" href="stk.calculators.ga.selectors.html#module-stk.calculators.ga.selectors" title="stk.calculators.ga.selectors"><code class="xref py py-mod docutils literal notranslate"><span class="pre">selectors</span></code></a></li>
<li><a class="reference internal" href="stk.calculators.ga.exiters.html#module-stk.calculators.ga.exiters" title="stk.calculators.ga.exiters"><code class="xref py py-mod docutils literal notranslate"><span class="pre">exiters</span></code></a></li>
<li><a class="reference internal" href="stk.calculators.ga.plotters.html#module-stk.calculators.ga.plotters" title="stk.calculators.ga.plotters"><code class="xref py py-mod docutils literal notranslate"><span class="pre">plotters</span></code></a></li>
</ul>
</div></blockquote>
<div class="section" id="combining-calculators">
<h3>Combining Calculators<a class="headerlink" href="#combining-calculators" title="Permalink to this headline">¶</a></h3>
<p>Calculators can be combined to create complex behaviour on the fly.
For example, we may wish to make a 2 step optimization process. First,
we perform an optimization using the MMFF force field and the run
a MacroModel molecular dynamics conformer search with
<a class="reference internal" href="stk.calculators.optimization.macromodel.html#stk.calculators.optimization.macromodel.MacroModelMD" title="stk.calculators.optimization.macromodel.MacroModelMD"><code class="xref py py-class docutils literal notranslate"><span class="pre">MacroModelMD</span></code></a>. The obvious way to do
this is to run the two optimizers in sequence</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mmff</span> <span class="o">=</span> <span class="n">MMFF</span><span class="p">()</span>
<span class="n">macromodel</span> <span class="o">=</span> <span class="n">MacroModelMD</span><span class="p">(</span><span class="n">macromodel_path</span><span class="o">=</span><span class="s1">&#39;/opt/schrodinger2017-4&#39;</span><span class="p">)</span>

<span class="n">mmff</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">macromodel</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
</pre></div>
</div>
<p>However, there is a better way! We can use an optimizer called
<a class="reference internal" href="stk.calculators.optimization.optimizers.html#stk.calculators.optimization.optimizers.OptimizerSequence" title="stk.calculators.optimization.optimizers.OptimizerSequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">OptimizerSequence</span></code></a>. The <a class="reference internal" href="stk.calculators.optimization.optimizers.html#stk.calculators.optimization.optimizers.OptimizerSequence.optimize" title="stk.calculators.optimization.optimizers.OptimizerSequence.optimize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">optimize()</span></code></a>
method of this optimizer calls the <a class="reference internal" href="stk.calculators.optimization.optimizers.html#stk.calculators.optimization.optimizers.Optimizer.optimize" title="stk.calculators.optimization.optimizers.Optimizer.optimize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">optimize()</span></code></a> methods
of the optimizers it was initialized with</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opt_sequence</span> <span class="o">=</span> <span class="n">OptimizerSequence</span><span class="p">(</span><span class="n">mmff</span><span class="p">,</span> <span class="n">macromodel</span><span class="p">)</span>
<span class="c1"># Optimize with mmff and then with macromodel.</span>
<span class="n">opt_sequence</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
</pre></div>
</div>
<p>This pattern is quite common and powerful. For example, we can take
three different <a class="reference internal" href="stk.calculators.ga.mutators.html#stk.calculators.ga.mutators.Mutator" title="stk.calculators.ga.mutators.Mutator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mutator</span></code></a> objects. Each of these defines
a different <a class="reference internal" href="stk.calculators.ga.mutators.html#stk.calculators.ga.mutators.Mutator.mutate" title="stk.calculators.ga.mutators.Mutator.mutate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mutate()</span></code></a> method. We want to apply one of
these mutations at random. We can simply use <a class="reference internal" href="stk.calculators.ga.mutators.html#stk.calculators.ga.mutators.RandomMutation" title="stk.calculators.ga.mutators.RandomMutation"><code class="xref py py-class docutils literal notranslate"><span class="pre">RandomMutation</span></code></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">random_bb</span> <span class="o">=</span> <span class="n">RandomBuildingBlock</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">similar_bb</span> <span class="o">=</span> <span class="n">SimilarBulidingBlock</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">random_topology</span> <span class="o">=</span> <span class="n">RandomTopology</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">random_mutation</span> <span class="o">=</span> <span class="n">RandomMutation</span><span class="p">(</span>
    <span class="n">random_bb</span><span class="p">,</span>
    <span class="n">similar_bb</span><span class="p">,</span>
    <span class="n">random_topology</span>
<span class="p">)</span>

<span class="c1"># Use one of the mutate() methods of random_bb, similar_bb and</span>
<span class="c1"># random_topology at random.</span>
<span class="n">mutant1</span> <span class="o">=</span> <span class="n">random_mutation</span><span class="o">.</span><span class="n">mutate</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="c1"># The next call use a different mutation to the call above.</span>
<span class="n">mutant2</span> <span class="o">=</span> <span class="n">random_mutation</span><span class="o">.</span><span class="n">mutate</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="stk.calculators.ga.mutators.html#stk.calculators.ga.mutators.RandomMutation.mutate" title="stk.calculators.ga.mutators.RandomMutation.mutate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RandomMutation.mutate()</span></code></a> method randomly selects a
<a class="reference internal" href="stk.calculators.ga.mutators.html#stk.calculators.ga.mutators.Mutator" title="stk.calculators.ga.mutators.Mutator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mutator</span></code></a> it was initialized with to carry out the mutation
on its behalf.</p>
</div>
<div class="section" id="making-new-calculators">
<h3>Making New Calculators<a class="headerlink" href="#making-new-calculators" title="Permalink to this headline">¶</a></h3>
<p>New calculators can be added very simply and they can be defined in
user code. Specific guidelines are defined in the module
dedicated to each type of calculator in <a class="reference internal" href="stk.calculators.html#module-stk.calculators" title="stk.calculators"><code class="xref py py-mod docutils literal notranslate"><span class="pre">calculators</span></code></a>.</p>
<p>A simple example of adding a new calculator in user code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NewEnergyCalculator</span><span class="p">(</span><span class="n">EnergyCalculator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">,</span> <span class="n">conformer</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">15</span>

<span class="n">energy_calc</span> <span class="o">=</span> <span class="n">NewEnergyCalculator</span><span class="p">()</span>
<span class="c1"># Calculate the energy with the new calculator.</span>
<span class="n">energy_calc</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that you can also modify the behaviour of existing calculators in
your code, some common patterns are described in
<a class="reference internal" href="modifying_calculators.html"><span class="doc">Modifying stk Calculators</span></a>.</p>
</div>
<div class="section" id="saving-calculator-results">
<h3>Saving Calculator Results<a class="headerlink" href="#saving-calculator-results" title="Permalink to this headline">¶</a></h3>
<p>If you want to save the results which your calculator found you should
set <code class="docutils literal notranslate"><span class="pre">use_cache=True</span></code> and then you can simply use <code class="xref py py-mod docutils literal notranslate"><span class="pre">pickle</span></code>
to dump and load the calculator object. You can inspect the saved
values by looking at the <code class="xref py py-attr docutils literal notranslate"><span class="pre">cache</span></code> attribute.</p>
</div>
<div class="section" id="calculating-molecular-properties">
<h3>Calculating Molecular Properties<a class="headerlink" href="#calculating-molecular-properties" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">stk</span></code> provides a variety of methods to calculate molecular properties.
What methods can be used depends on what kind of molecule object is created.
Note that all molecules can use methods defined in <a class="reference internal" href="stk.molecular.molecules.molecule.html#stk.molecular.molecules.molecule.Molecule" title="stk.molecular.molecules.molecule.Molecule"><code class="xref py py-class docutils literal notranslate"><span class="pre">Molecule</span></code></a>.</p>
<p>Here are some examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the maximum diameter of of a molecule.</span>
<span class="n">mol</span><span class="o">.</span><span class="n">max_diameter</span><span class="p">()</span>
<span class="c1"># Calculate the cavity size of a cage molecule.</span>
<span class="n">cage</span><span class="o">.</span><span class="n">cavity_size</span><span class="p">()</span>
<span class="c1"># Calculate the mean RMSD between the building blocks original</span>
<span class="c1"># structure and their structure inside an assembled macromolecule.</span>
<span class="n">macro_mol</span><span class="o">.</span><span class="n">bb_distortion</span><span class="p">()</span>
<span class="c1"># Get the center of mass of a molecule.</span>
<span class="n">mol</span><span class="o">.</span><span class="n">center_of_mass</span><span class="p">()</span>
<span class="c1"># Get the atomic symbol of atom with id of 13.</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom_symbol</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="geometric-manipulations">
<h3>Geometric Manipulations<a class="headerlink" href="#geometric-manipulations" title="Permalink to this headline">¶</a></h3>
<p>In addition to molecular property calculation, <code class="docutils literal notranslate"><span class="pre">stk</span></code> provides tools to
rotate and translate molecules. These tools are particularly useful when
defining the assembly process of a new class of molecules.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change the position of a molecule.</span>
<span class="n">mol</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="c1"># Get a matrix holding the position of every atom in the molecule.</span>
<span class="n">mol</span><span class="o">.</span><span class="n">position_matrix</span><span class="p">()</span>
<span class="c1"># Use a matrix to set the position of every atom in the molecule.</span>
<span class="n">mol</span><span class="o">.</span><span class="n">set_position_from_matrix</span><span class="p">(</span><span class="n">some_matrix</span><span class="p">)</span>
<span class="c1"># Rotate the molecule along by pi radians about the vector (1, 1, 3)</span>
<span class="n">mol</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dealing-with-multiple-conformers">
<h2>Dealing with Multiple Conformers<a class="headerlink" href="#dealing-with-multiple-conformers" title="Permalink to this headline">¶</a></h2>
<p>Every <a class="reference internal" href="stk.molecular.molecules.molecule.html#stk.molecular.molecules.molecule.Molecule" title="stk.molecular.molecules.molecule.Molecule"><code class="xref py py-class docutils literal notranslate"><span class="pre">Molecule</span></code></a>, be it a <a class="reference internal" href="stk.molecular.molecules.struct_unit.html#stk.molecular.molecules.struct_unit.StructUnit" title="stk.molecular.molecules.struct_unit.StructUnit"><code class="xref py py-class docutils literal notranslate"><span class="pre">StructUnit</span></code></a> or a <a class="reference internal" href="stk.molecular.molecules.macro_molecule.html#stk.molecular.molecules.macro_molecule.MacroMolecule" title="stk.molecular.molecules.macro_molecule.MacroMolecule"><code class="xref py py-class docutils literal notranslate"><span class="pre">MacroMolecule</span></code></a>
supports multiple conformers. These are stored in the underlying
<code class="xref py py-mod docutils literal notranslate"><span class="pre">rdkit</span></code> object held in <code class="xref py py-class docutils literal notranslate"><span class="pre">Molecule.mol</span></code>.</p>
<p>Adding a new conformer to a <a class="reference internal" href="stk.molecular.molecules.struct_unit.html#stk.molecular.molecules.struct_unit.StructUnit" title="stk.molecular.molecules.struct_unit.StructUnit"><code class="xref py py-class docutils literal notranslate"><span class="pre">StructUnit</span></code></a> is simple</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bb1</span> <span class="o">=</span> <span class="n">StructUnit2</span><span class="p">(</span><span class="s1">&#39;bb1_conf1.mol&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;amine&#39;</span><span class="p">])</span> <span class="c1"># Loads molecule into conformer 0.</span>
<span class="n">bb1</span><span class="o">.</span><span class="n">update_from_mol</span><span class="p">(</span><span class="s1">&#39;bb1_conf2.mol&#39;</span><span class="p">,</span> <span class="n">conformer</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Load into conformer 1.</span>
</pre></div>
</div>
<p>Lets take a look</p>
<blockquote>
<div><img alt="_images/bb1_confs.png" src="_images/bb1_confs.png" />
</div></blockquote>
<p>Well, one is clearly better than the other. At least they are easy to
recognize.</p>
<p>Lets try this with a another building block as well</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bb2</span> <span class="o">=</span> <span class="n">StructUnit3</span><span class="p">(</span><span class="s1">&#39;bb2_conf1.mol&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aldehyde&#39;</span><span class="p">])</span>
<span class="n">bb2</span> <span class="o">=</span> <span class="n">bb2</span><span class="o">.</span><span class="n">update_from_mol</span><span class="p">(</span><span class="s1">&#39;bb2_conf2.mol&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/bb2_confs.png" src="_images/bb2_confs.png" />
<p>Also pretty distinguishable. This is good, it makes it easy to show
that you can pick which conformers to use for assembly with <a class="reference internal" href="stk.molecular.molecules.macro_molecule.html#stk.molecular.molecules.macro_molecule.MacroMolecule" title="stk.molecular.molecules.macro_molecule.MacroMolecule"><code class="xref py py-class docutils literal notranslate"><span class="pre">MacroMolecule</span></code></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cage</span> <span class="o">=</span> <span class="n">Cage</span><span class="p">([</span><span class="n">bb1</span><span class="p">,</span> <span class="n">bb2</span><span class="p">],</span> <span class="n">FourPlusSix</span><span class="p">(),</span> <span class="n">bb_conformers</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">cage</span><span class="o">.</span><span class="n">add_conformer</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">cage</span><span class="o">.</span><span class="n">add_conformer</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">cage</span><span class="o">.</span><span class="n">add_conformer</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>These are the conformers we produced!</p>
<img alt="_images/1.png" src="_images/1.png" />
<img alt="_images/2.png" src="_images/2.png" />
<img alt="_images/3.png" src="_images/3.png" />
<img alt="_images/4.png" src="_images/4.png" />
<p><code class="docutils literal notranslate"><span class="pre">stk</span></code> will use whichever <a class="reference internal" href="stk.molecular.molecules.struct_unit.html#stk.molecular.molecules.struct_unit.StructUnit" title="stk.molecular.molecules.struct_unit.StructUnit"><code class="xref py py-class docutils literal notranslate"><span class="pre">StructUnit</span></code></a> conformers you want, when
constructing conformers of the <a class="reference internal" href="stk.molecular.molecules.macro_molecule.html#stk.molecular.molecules.macro_molecule.MacroMolecule" title="stk.molecular.molecules.macro_molecule.MacroMolecule"><code class="xref py py-class docutils literal notranslate"><span class="pre">MacroMolecule</span></code></a> itself.</p>
<p>Most methods and functions in <code class="docutils literal notranslate"><span class="pre">stk</span></code> also support conformers.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mol</span><span class="o">.</span><span class="n">position_matrix</span><span class="p">(</span><span class="n">conformer</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mol</span><span class="o">.</span><span class="n">energy</span><span class="o">.</span><span class="n">rdkit</span><span class="p">(</span><span class="s1">&#39;uff&#39;</span><span class="p">,</span> <span class="n">conformer</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mol</span><span class="o">.</span><span class="n">cavity_size</span><span class="p">(</span><span class="n">conformer</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># And so on ...</span>
</pre></div>
</div>
<div class="section" id="dealing-with-multiple-molecules">
<h3>Dealing with Multiple Molecules<a class="headerlink" href="#dealing-with-multiple-molecules" title="Permalink to this headline">¶</a></h3>
<p>When batches of molecules are created, it is often desirable to optimize
them all at once. By placing the molecules in a <a class="reference internal" href="stk.populations.html#stk.populations.Population" title="stk.populations.Population"><code class="xref py py-class docutils literal notranslate"><span class="pre">Population</span></code></a>
instance, all molecules can be optimized in parallel.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mmff</span> <span class="o">=</span> <span class="n">MMFF</span><span class="p">()</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">Population</span><span class="p">(</span><span class="n">cage</span><span class="p">,</span> <span class="n">cage2</span><span class="p">,</span> <span class="n">cage3</span><span class="p">)</span>
<span class="n">pop</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">mmff</span><span class="p">)</span>
</pre></div>
</div>
<p>In addition to this, the <a class="reference internal" href="stk.populations.html#stk.populations.Population" title="stk.populations.Population"><code class="xref py py-class docutils literal notranslate"><span class="pre">Population</span></code></a> class provides some handy
tools to assemble large amounts of molecules at a time. For example if
we want to create every possible cage from a set of building blocks and
topologies:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bbs1</span> <span class="o">=</span> <span class="p">[</span><span class="n">StructUnit2</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;aldehyde&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;1.mol&#39;</span><span class="p">,</span> <span class="s1">&#39;2.mol&#39;</span><span class="p">,</span> <span class="s1">&#39;3.mol&#39;</span><span class="p">)]</span>
<span class="n">bbs2</span> <span class="o">=</span> <span class="p">[</span><span class="n">StructUnit3</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;amine&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;4.mol&#39;</span><span class="p">,</span> <span class="s1">&#39;5.mol&#39;</span><span class="p">,</span> <span class="s1">&#39;6.mol&#39;</span><span class="p">)]</span>
<span class="c1"># Create 18 Cage molecules.</span>
<span class="n">pop2</span> <span class="o">=</span> <span class="n">Population</span><span class="o">.</span><span class="n">init_all</span><span class="p">(</span><span class="n">Cage</span><span class="p">,</span> <span class="p">[</span><span class="n">bbs1</span><span class="p">,</span> <span class="n">bbs2</span><span class="p">],</span> <span class="p">[</span><span class="n">FourPlusSix</span><span class="p">(),</span> <span class="n">EightPlusTwelve</span><span class="p">()])</span>
</pre></div>
</div>
<p>Or if we want to select building blocks at random and create 5 cages:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pop3</span> <span class="o">=</span> <span class="n">Population</span><span class="o">.</span><span class="n">init_random</span><span class="p">(</span><span class="n">Cage</span><span class="p">,</span> <span class="p">[</span><span class="n">bbs1</span><span class="p">,</span> <span class="n">bbs2</span><span class="p">],</span> <span class="p">[</span><span class="n">FourPlusSix</span><span class="p">(),</span> <span class="n">EightPlusTwelve</span><span class="p">()],</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>The population can also be used to calculate statistics across all
molecules. For example, if you want to know the average cavity size of
your cages:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pop</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">cavity_size</span><span class="p">())</span>
</pre></div>
</div>
<p>Finally, we can use the population to write structure files of
all the molecules to a folder</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pop</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;dirname&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>or we can dump the population to a JSON file</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pop</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;pop.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>and recover the <code class="docutils literal notranslate"><span class="pre">stk</span></code> objects later</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pop</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;pop.json&#39;</span><span class="p">,</span> <span class="n">Molecule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">)</span>
<span class="n">pop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># &lt;StructUnit2 at 0x01283&gt;</span>
<span class="n">pop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># &lt;Periodic at 0x12498&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="automated-molecular-design-with-genetic-algorithms">
<h2>Automated Molecular Design with Genetic Algorithms<a class="headerlink" href="#automated-molecular-design-with-genetic-algorithms" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">stk</span></code> includes a genetic algorithm which
can be used to evolve molecules that fulfil user defined design criteria.
The genetic algorithm can be run from the command line using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m stk.ga input_file.py
</pre></div>
</div>
<p>The input file is a simple python script which defines the
calculators the genetic algorithm should use, as well as some optional
parameters.</p>
<p>The genetic algorithm automatically works with any molecules that <code class="docutils literal notranslate"><span class="pre">stk</span></code>
uses, both <a class="reference internal" href="stk.molecular.molecules.struct_unit.html#stk.molecular.molecules.struct_unit.StructUnit" title="stk.molecular.molecules.struct_unit.StructUnit"><code class="xref py py-class docutils literal notranslate"><span class="pre">StructUnit</span></code></a> and <a class="reference internal" href="stk.molecular.molecules.macro_molecule.html#stk.molecular.molecules.macro_molecule.MacroMolecule" title="stk.molecular.molecules.macro_molecule.MacroMolecule"><code class="xref py py-class docutils literal notranslate"><span class="pre">MacroMolecule</span></code></a> objects.</p>
<p>Take for example the following input file which runs the GA on polymers
and selects building blocks which have the most atoms.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># #####################################################################</span>
<span class="c1"># Imports.</span>
<span class="c1"># #####################################################################</span>

<span class="kn">import</span> <span class="nn">stk</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Set the number of cores to use.</span>
<span class="c1"># #####################################################################</span>

<span class="c1"># This argument is optional, will default to use all CPU cores on</span>
<span class="c1"># your PC.</span>
<span class="n">processes</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Set logging level.</span>
<span class="c1"># #####################################################################</span>

<span class="c1"># This argument is optional, will default to logging.INFO</span>
<span class="n">logging_level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Toggle the writing of a log file.</span>
<span class="c1"># #####################################################################</span>

<span class="c1"># This argument is optional, will default to True.</span>
<span class="n">log_file</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Toggle the dumping of generated molecules.</span>
<span class="c1"># #####################################################################</span>

<span class="c1"># This argument is optional, will default to True.</span>
<span class="n">database_dump</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Toggle the dumping of GA generations.</span>
<span class="c1"># #####################################################################</span>

<span class="c1"># This argument is optional, will default to True.</span>
<span class="n">progress_dump</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Toggle the dumping of molecules at every generation.</span>
<span class="c1"># #####################################################################</span>

<span class="c1"># This argument is optional, will default to False.</span>
<span class="n">debug_dumps</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Make a tar archive of the output.</span>
<span class="c1"># #####################################################################</span>

<span class="c1"># This argument is optional, will default to False.</span>
<span class="n">tar_output</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Initial population.</span>
<span class="c1"># #####################################################################</span>

<span class="c1"># Only the &quot;population&quot; variable must be defined in the input file.</span>
<span class="c1"># The other variables defined in this section are to make the code</span>
<span class="c1"># more readable.</span>

<span class="n">carbon</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
<span class="n">building_blocks</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">stk</span><span class="o">.</span><span class="n">StructUnit2</span><span class="o">.</span><span class="n">smiles_init</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;[Br]{carbon*i}[Br]&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bromine&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">topologies</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">stk</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span>
    <span class="n">stk</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">6</span><span class="p">),</span>
    <span class="n">stk</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">12</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># population holds the initial population of the GA.</span>
<span class="n">population</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">GAPopulation</span><span class="o">.</span><span class="n">init_random</span><span class="p">(</span><span class="n">stk</span><span class="o">.</span><span class="n">Polymer</span><span class="p">,</span>
                                          <span class="p">[</span><span class="n">building_blocks</span><span class="p">],</span>
                                          <span class="n">topologies</span><span class="p">,</span>
                                          <span class="mi">25</span><span class="p">)</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Selector for selecting the next generation.</span>
<span class="c1"># #####################################################################</span>

<span class="n">generation_selector</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">SelectorSequence</span><span class="p">(</span>
    <span class="n">stk</span><span class="o">.</span><span class="n">Fittest</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
    <span class="n">stk</span><span class="o">.</span><span class="n">Roulette</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Selector for selecting parents.</span>
<span class="c1"># #####################################################################</span>

<span class="n">crossover_selector</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">AboveAverage</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Selector for selecting molecules for mutation.</span>
<span class="c1"># #####################################################################</span>

<span class="n">mutation_selector</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">SelectorFunnel</span><span class="p">(</span>
    <span class="n">stk</span><span class="o">.</span><span class="n">AboveAverage</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
    <span class="n">stk</span><span class="o">.</span><span class="n">Roulette</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Crosser.</span>
<span class="c1"># #####################################################################</span>

<span class="n">crosser</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">Jumble</span><span class="p">(</span><span class="n">num_offspring_building_blocks</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Mutator.</span>
<span class="c1"># #####################################################################</span>

<span class="n">mutator</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">RandomMutation</span><span class="p">(</span>
    <span class="n">stk</span><span class="o">.</span><span class="n">RandomTopology</span><span class="p">(</span><span class="n">topologies</span><span class="p">),</span>
    <span class="n">stk</span><span class="o">.</span><span class="n">RandomBuildingBlock</span><span class="p">(</span><span class="n">building_blocks</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">mol</span><span class="p">:</span> <span class="bp">True</span><span class="p">),</span>
    <span class="n">stk</span><span class="o">.</span><span class="n">SimilarBuildingBlock</span><span class="p">(</span><span class="n">building_blocks</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">mol</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Optimizer.</span>
<span class="c1"># #####################################################################</span>

<span class="c1"># Remember to set use_cache to True for the GA.</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">MMFF</span><span class="p">(</span><span class="n">use_cache</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Fitness calculator.</span>
<span class="c1"># #####################################################################</span>


<span class="k">def</span> <span class="nf">num_atoms</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">conformer</span><span class="p">):</span>
    <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
    <span class="c1"># Save the number of atoms in an attribute for later plotting.</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">num_atoms</span> <span class="o">=</span> <span class="n">n_atoms</span>
    <span class="k">return</span> <span class="n">n_atoms</span>


<span class="n">fitness_calculator</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">PropertyVector</span><span class="p">(</span><span class="n">num_atoms</span><span class="p">)</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Fitness normalizer.</span>
<span class="c1"># #####################################################################</span>

<span class="c1"># This is an optional argument, will default to NullFitnessNormalizer.</span>

<span class="c1"># The PropertyVector fitness calculator will set the fitness as</span>
<span class="c1"># [n_atoms] use the Sum() fitness normalizer to convert the fitness to</span>
<span class="c1"># just n_atoms^0.5. The sqrt is because we use the Power normalizer.</span>
<span class="n">fitness_normalizer</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">NormalizerSequence</span><span class="p">(</span>
    <span class="n">stk</span><span class="o">.</span><span class="n">Power</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="n">stk</span><span class="o">.</span><span class="n">Sum</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Exit condition.</span>
<span class="c1"># #####################################################################</span>

<span class="n">exiter</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">NumGenerations</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>

<span class="c1"># #####################################################################</span>
<span class="c1"># Make plotters.</span>
<span class="c1"># #####################################################################</span>

<span class="c1"># This is an optional argument, no plotting will be made by default.</span>

<span class="n">plotters</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">stk</span><span class="o">.</span><span class="n">ProgressPlotter</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;fitness_plot&#39;</span><span class="p">,</span>
                        <span class="n">attr</span><span class="o">=</span><span class="s1">&#39;fitness&#39;</span><span class="p">,</span>
                        <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;Fitness&#39;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
    <span class="n">stk</span><span class="o">.</span><span class="n">ProgressPlotter</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;atom_number_plot&#39;</span><span class="p">,</span>
                        <span class="n">attr</span><span class="o">=</span><span class="s1">&#39;num_atoms&#39;</span><span class="p">,</span>
                        <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;Number of Atoms&#39;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">stk</span><span class="o">.</span><span class="n">SelectionPlotter</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;generational_selection&#39;</span><span class="p">,</span>
                     <span class="n">selector</span><span class="o">=</span><span class="n">generation_selector</span><span class="p">)</span>
<span class="n">stk</span><span class="o">.</span><span class="n">SelectionPlotter</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;crossover_selection&#39;</span><span class="p">,</span>
                     <span class="n">selector</span><span class="o">=</span><span class="n">crossover_selector</span><span class="p">)</span>
<span class="n">stk</span><span class="o">.</span><span class="n">SelectionPlotter</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;mutation_selection&#39;</span><span class="p">,</span>
                     <span class="n">selector</span><span class="o">=</span><span class="n">mutation_selector</span><span class="p">)</span>
</pre></div>
</div>
<p>Running the genetic algorithm with this input file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m stk.ga big_monomers.py
</pre></div>
</div>
<p>will produce the following directory structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|--</span> <span class="n">stk_ga_runs</span>
<span class="o">|</span>   <span class="o">|--</span> <span class="mi">0</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">scratch</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">atom_number_plot</span><span class="o">.</span><span class="n">png</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">atom_number_plot</span><span class="o">.</span><span class="n">csv</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">fitness_plot</span><span class="o">.</span><span class="n">png</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">fitness_plot</span><span class="o">.</span><span class="n">csv</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">generational_selection_1</span><span class="o">.</span><span class="n">png</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">crossover_selection_1</span><span class="o">.</span><span class="n">png</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">mutation_selection_1</span><span class="o">.</span><span class="n">png</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">progress</span><span class="o">.</span><span class="n">log</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="o">...</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">final_pop</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="mf">150.</span><span class="n">mol</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="mf">2160.</span><span class="n">mol</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="mf">9471.</span><span class="n">mol</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="o">...</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">big_monomers</span><span class="o">.</span><span class="n">py</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">database</span><span class="o">.</span><span class="n">json</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">progress</span><span class="o">.</span><span class="n">json</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">errors</span><span class="o">.</span><span class="n">log</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">output</span><span class="o">.</span><span class="n">tgz</span>
</pre></div>
</div>
<p>A glance at the evolutionary progress plot in
<code class="docutils literal notranslate"><span class="pre">scratch/fitness_plot.png</span></code> will show us how well our GA did.</p>
<img alt="_images/epp.png" src="_images/epp.png" />
<p>Running the genetic algorithm again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m stk.ga big_monomers.py
</pre></div>
</div>
<p>will add a second subfolder with the same structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|--</span> <span class="n">stk_ga_runs</span>
<span class="o">|</span>   <span class="o">|--</span> <span class="mi">0</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">counters</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">gen_1_crossover_counter</span><span class="o">.</span><span class="n">png</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">gen_1_mutation_counter</span><span class="o">.</span><span class="n">png</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">gen_1_selection_counter</span><span class="o">.</span><span class="n">png</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="o">...</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">final_pop</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="mf">150.</span><span class="n">mol</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="mf">2160.</span><span class="n">mol</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="mf">9471.</span><span class="n">mol</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="o">...</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">big_monomers</span><span class="o">.</span><span class="n">py</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">database</span><span class="o">.</span><span class="n">json</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">progress</span><span class="o">.</span><span class="n">json</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">errors</span><span class="o">.</span><span class="n">log</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">progress</span><span class="o">.</span><span class="n">log</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">epp</span><span class="o">.</span><span class="n">png</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">epp</span><span class="o">.</span><span class="n">csv</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">output</span><span class="o">.</span><span class="n">tgz</span>
<span class="o">|</span>
<span class="o">|</span>   <span class="o">|--</span> <span class="mi">1</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">scratch</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">atom_number_plot</span><span class="o">.</span><span class="n">png</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">atom_number_plot</span><span class="o">.</span><span class="n">csv</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">fitness_plot</span><span class="o">.</span><span class="n">png</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">fitness_plot</span><span class="o">.</span><span class="n">csv</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">generational_selection_1</span><span class="o">.</span><span class="n">png</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">crossover_selection_1</span><span class="o">.</span><span class="n">png</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">mutation_selection_1</span><span class="o">.</span><span class="n">png</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">progress</span><span class="o">.</span><span class="n">log</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="o">...</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">final_pop</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="mf">150.</span><span class="n">mol</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="mf">2160.</span><span class="n">mol</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="mf">9471.</span><span class="n">mol</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="o">...</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">big_monomers</span><span class="o">.</span><span class="n">py</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">database</span><span class="o">.</span><span class="n">json</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">progress</span><span class="o">.</span><span class="n">json</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">errors</span><span class="o">.</span><span class="n">log</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="n">output</span><span class="o">.</span><span class="n">tgz</span>
</pre></div>
</div>
<p>The genetic algorithm can also be run multiple times in a row:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m stk.ga -l 5 big_monomers.py
</pre></div>
</div>
<p>which will run the GA 5 separate times adding 5 more subfolders to the
directory structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|--</span> <span class="n">stk_ga_runs</span>
<span class="o">|</span>   <span class="o">|--</span> <span class="mi">0</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="o">...</span>
<span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|--</span> <span class="mi">1</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="o">...</span>
<span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|--</span> <span class="mi">2</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="o">...</span>
<span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|--</span> <span class="mi">3</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="o">...</span>
<span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|--</span> <span class="mi">4</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="o">...</span>
<span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|--</span> <span class="mi">5</span>
<span class="o">|</span>   <span class="o">|</span>   <span class="o">|--</span> <span class="o">...</span>
<span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|--</span> <span class="mi">6</span>
        <span class="o">|--</span> <span class="o">...</span>
</pre></div>
</div>
<p>The benefit of using the <code class="docutils literal notranslate"><span class="pre">-l</span></code> option is that the molecular cache is
not reset between each run. This means that a molecule which was constructed,
optimized and had its fitness value calculated in the first run will
not need to be re-constructed, re-optimized or have fitness value
re-calculated in any of the subsequent runs. The cached version
of the molecule will be used.</p>
<p>However, the molecular cache be pre-loaded even when the <code class="docutils literal notranslate"><span class="pre">-l</span></code> option is
not used, simply load the molecules in the input file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># some input_file.py</span>

<span class="c1"># There is no need to save this population into a variable.</span>
<span class="c1"># It is enough to load the molecules to place them into the cache.</span>
<span class="n">stk</span><span class="o">.</span><span class="n">Population</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;dumped_molecules.json&#39;</span><span class="p">,</span>
                    <span class="n">stk</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">)</span>
</pre></div>
</div>
<p>The output of a single GA consists of a number of files and
directories. The <code class="docutils literal notranslate"><span class="pre">scratch</span></code> directory holds any files created during
the GA run. For example, the <code class="docutils literal notranslate"><span class="pre">.png</span></code> files showing
how frequently a member of the population was selected for mutation,
crossover and generational selection. For example, this is a
mutation counter</p>
<img alt="_images/counter_example.png" src="_images/counter_example.png" />
<p>It shows that molecule <code class="docutils literal notranslate"><span class="pre">8</span></code> was selected three times for mutation, while molecules
<code class="docutils literal notranslate"><span class="pre">40</span></code>, <code class="docutils literal notranslate"><span class="pre">23`</span></code> were selected once. The
remaining molecules were not mutated in that generation.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">final_pop</span></code> directory holds the <code class="docutils literal notranslate"><span class="pre">.mol</span></code> files holding the
structures of the last generation of molecules.
The file <code class="docutils literal notranslate"><span class="pre">big_monomers.py</span></code> is a copy of the input file. The <code class="docutils literal notranslate"><span class="pre">database.json</span></code>
file is a population dump file which holds every molecule produced by
the GA during the run. <code class="docutils literal notranslate"><span class="pre">progress.json</span></code> is also a population dump file.
This population holds
every generation of the GA as a subpopulation. This is quite useful
if you want to analyse the output of the GA generation-wise.</p>
<p><code class="docutils literal notranslate"><span class="pre">errors.log</span></code> is a file which contains every exception and its
traceback encountered by the GA during its run.</p>
<p><code class="docutils literal notranslate"><span class="pre">progress.log</span></code> is a file which lists which molecules make up each
generation, and their respective fitness values.</p>
<p><code class="docutils literal notranslate"><span class="pre">output.tgz</span></code> is a tarred and compressed copy of the output folder for
the run.
This means if you want to share you entire run output you can just
share this file.</p>
<p>Finally, when running the GA the progress will be printed into
stderr. The message should be relatively straightforward, such as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">======================================================================</span>

<span class="mi">17</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">20</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">stk</span><span class="o">.</span><span class="n">ga</span><span class="o">.</span><span class="n">mutation</span> <span class="o">-</span> <span class="n">Using</span> <span class="n">random_bb</span><span class="o">.</span>

<span class="o">======================================================================</span>
</pre></div>
</div>
<p>which shows the time, the level of the message which can be, in order of
priority DEBUG, INFO, WARNING, ERROR or CRITICAL, the module where
the message originated and finally the message itself.</p>
<div class="section" id="genetic-algorithm-input-file-variables">
<h3>Genetic algorithm input file variables.<a class="headerlink" href="#genetic-algorithm-input-file-variables" title="Permalink to this headline">¶</a></h3>
<p>This section lists the variables that need to be defined in the GA
input file, along with a description of each variable.</p>
<ul class="simple">
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">population</span></code> - <a class="reference internal" href="stk.populations.html#stk.populations.GAPopulation" title="stk.populations.GAPopulation"><code class="xref py py-class docutils literal notranslate"><span class="pre">GAPopulation</span></code></a> - <strong>mandatory</strong> -
The initial population of the GA.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">optimizer</span></code> - <a class="reference internal" href="stk.calculators.optimization.optimizers.html#stk.calculators.optimization.optimizers.Optimizer" title="stk.calculators.optimization.optimizers.Optimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Optimizer</span></code></a> - <strong>mandatory</strong> - The
optimizer used to optimize the molecules created by the GA.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">fitness_calculator</span></code> - <a class="reference internal" href="stk.calculators.ga.fitness_calculators.html#stk.calculators.ga.fitness_calculators.FitnessCalculator" title="stk.calculators.ga.fitness_calculators.FitnessCalculator"><code class="xref py py-class docutils literal notranslate"><span class="pre">FitnessCalculator</span></code></a> -
<strong>mandatory</strong> - The fitness calculator used to calculate fitness of
molecules.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">crosser</span></code> - <a class="reference internal" href="stk.calculators.ga.crossers.html#stk.calculators.ga.crossers.Crosser" title="stk.calculators.ga.crossers.Crosser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Crosser</span></code></a> - <strong>mandatory</strong> - The crosser
used to carry out crossover operations.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">mutator</span></code> - <a class="reference internal" href="stk.calculators.ga.mutators.html#stk.calculators.ga.mutators.Mutator" title="stk.calculators.ga.mutators.Mutator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mutator</span></code></a> - <strong>mandatory</strong> - The mutator
used to carry out mutation operations.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">generation_selector</span></code> - <a class="reference internal" href="stk.calculators.ga.selectors.html#stk.calculators.ga.selectors.Selector" title="stk.calculators.ga.selectors.Selector"><code class="xref py py-class docutils literal notranslate"><span class="pre">Selector</span></code></a> - <strong>mandatory</strong> -
The selector used to select the next generation.
<a class="reference internal" href="stk.calculators.ga.selectors.html#stk.calculators.ga.selectors.Selector.batch_size" title="stk.calculators.ga.selectors.Selector.batch_size"><code class="xref py py-attr docutils literal notranslate"><span class="pre">batch_size</span></code></a> must be <code class="docutils literal notranslate"><span class="pre">1</span></code>.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">mutation_selector</span></code> - <a class="reference internal" href="stk.calculators.ga.selectors.html#stk.calculators.ga.selectors.Selector" title="stk.calculators.ga.selectors.Selector"><code class="xref py py-class docutils literal notranslate"><span class="pre">Selector</span></code></a> - <strong>mandatory</strong> - The
selector used to select molecules to mutate.
<a class="reference internal" href="stk.calculators.ga.selectors.html#stk.calculators.ga.selectors.Selector.batch_size" title="stk.calculators.ga.selectors.Selector.batch_size"><code class="xref py py-attr docutils literal notranslate"><span class="pre">batch_size</span></code></a> must be <code class="docutils literal notranslate"><span class="pre">1</span></code>.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">crossover_selector</span></code> - <a class="reference internal" href="stk.calculators.ga.selectors.html#stk.calculators.ga.selectors.Selector" title="stk.calculators.ga.selectors.Selector"><code class="xref py py-class docutils literal notranslate"><span class="pre">Selector</span></code></a> - <strong>mandatory</strong> -
The selector used to select molecules for crossover.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">exiter</span></code> - <a class="reference internal" href="stk.calculators.ga.exiters.html#stk.calculators.ga.exiters.Exiter" title="stk.calculators.ga.exiters.Exiter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Exiter</span></code></a> - <strong>mandatory</strong> -
The exiter which determines if the GA has satisfied its exit
condition.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">fitness_normalizer</span></code> - <a class="reference internal" href="stk.calculators.ga.fitness_normalizers.html#stk.calculators.ga.fitness_normalizers.FitnessNormalizer" title="stk.calculators.ga.fitness_normalizers.FitnessNormalizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">FitnessNormalizer</span></code></a> -
<em>optional, default =</em> <a class="reference internal" href="stk.calculators.ga.fitness_normalizers.html#stk.calculators.ga.fitness_normalizers.NullFitnessNormalizer" title="stk.calculators.ga.fitness_normalizers.NullFitnessNormalizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullFitnessNormalizer()</span></code></a> - The fitness
normalizer which normalizes fitness values each generation.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">processes</span></code> - <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code> -
<em>optional, default =</em> <code class="xref py py-func docutils literal notranslate"><span class="pre">psutil.cpu_count()</span></code> - The number of CPU
cores the GA should use.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">plotters</span></code> - <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <a class="reference internal" href="stk.calculators.ga.plotters.html#stk.calculators.ga.plotters.Plotter" title="stk.calculators.ga.plotters.Plotter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Plotter</span></code></a> -
<em>optional, default =</em> <code class="docutils literal notranslate"><span class="pre">[]</span></code> - Plotters which are used to plot graphs
at the end of the GA.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">log_file</span></code> - <code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code> -
<em>optional, default =</em> <code class="docutils literal notranslate"><span class="pre">True</span></code> - Toggles whether a log file which
lists which molecules are present in each generation should be made.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">database_dump</span></code> - <code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code> -
<em>optional, default =</em> <code class="docutils literal notranslate"><span class="pre">True</span></code> - Toggles whether a
<a class="reference internal" href="stk.populations.html#stk.populations.Population" title="stk.populations.Population"><code class="xref py py-class docutils literal notranslate"><span class="pre">Population</span></code></a> JSON file should be made at the end of the GA
run. It will hold every molecule made by the GA.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">progress_dump</span></code> - <code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code> -
<em>optional, default =</em> <code class="docutils literal notranslate"><span class="pre">True</span></code> - Toggles whether a
<a class="reference internal" href="stk.populations.html#stk.populations.Population" title="stk.populations.Population"><code class="xref py py-class docutils literal notranslate"><span class="pre">Population</span></code></a> JSON file should be made at the end of the GA
run. It will hold every generation of the GA as a separate
subpopulation.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">debug_dumps</span></code> - <code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code> -
<em>optional, default =</em> <code class="docutils literal notranslate"><span class="pre">False</span></code> - If <code class="docutils literal notranslate"><span class="pre">True</span></code> a database and progress
dump is made after every generation rather than just the end. This is
nice for debugging but can seriously slow down the GA.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">tar_output</span></code> - <code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code> -
<em>optional, default =</em> <code class="docutils literal notranslate"><span class="pre">False</span></code> - If <code class="docutils literal notranslate"><span class="pre">True</span></code> then a compressed tar
archive of the output folder will be made.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">logging_level</span></code> - <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code> -
<em>optional, default =</em> <code class="docutils literal notranslate"><span class="pre">logging.INFO</span></code> - Sets the logging level in
the GA.</li>
</ul>
</div>
</div>
<div class="section" id="extending-stk">
<span id="id1"></span><h2>Extending <code class="docutils literal notranslate"><span class="pre">stk</span></code><a class="headerlink" href="#extending-stk" title="Permalink to this headline">¶</a></h2>
<p>Each module of <code class="docutils literal notranslate"><span class="pre">stk</span></code> has its own guidelines for adding new functionality.
However, in almost all cases adding new features to <code class="docutils literal notranslate"><span class="pre">stk</span></code> only involves
defining a simple class in the appropriate module. All of the extensions
can be done in user code so stk source code does not need to be
modified directly in order to be extended.</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="stk.molecular.molecules.macro_molecule.html#adding-macromolecules"><span class="std std-ref">Extending stk: Adding new macromolecules.</span></a></li>
<li><a class="reference internal" href="stk.molecular.topologies.base.html#adding-topologies"><span class="std std-ref">Extending stk: Adding new topologies.</span></a></li>
<li><a class="reference internal" href="stk.molecular.functional_groups.html#adding-functional-groups"><span class="std std-ref">Extending stk: Adding  more functional groups.</span></a></li>
<li><a class="reference internal" href="stk.calculators.optimization.html#adding-optimizers"><span class="std std-ref">Extending stk: Making new optimizers.</span></a></li>
<li><a class="reference internal" href="stk.calculators.energy.html#adding-energy-calculators"><span class="std std-ref">Extending stk: Making new energy calculators.</span></a></li>
<li><a class="reference internal" href="stk.calculators.electronic_property.html#adding-electronic-property-calculators"><span class="std std-ref">Extending stk: Making new electronic property calculators.</span></a></li>
<li><a class="reference internal" href="stk.calculators.ga.mutators.html#adding-mutators"><span class="std std-ref">Extending stk: Making new mutators.</span></a></li>
<li><a class="reference internal" href="stk.calculators.ga.crossers.html#adding-crossers"><span class="std std-ref">Extending stk: Making new crossers.</span></a></li>
<li><a class="reference internal" href="stk.calculators.ga.fitness_calculators.html#adding-fitness-calculators"><span class="std std-ref">Extending stk: Making new fitness calculators.</span></a></li>
<li><a class="reference internal" href="stk.calculators.ga.fitness_normalizers.html#adding-fitness-normalizers"><span class="std std-ref">Extending stk: Making new fitness normalizers.</span></a></li>
<li><a class="reference internal" href="stk.calculators.ga.selectors.html#adding-selectors"><span class="std std-ref">Extending stk: Making new selectors.</span></a></li>
<li><a class="reference internal" href="stk.calculators.ga.exiters.html#adding-exiters"><span class="std std-ref">Extending stk: Making new exiters.</span></a></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="further-reading">
<h2>Further Reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="stk.molecular.molecules.macro_molecule.html#macromolecular-assembly"><span class="std std-ref">A more detailed description of macromolecular assembly.</span></a></li>
<li><a class="reference internal" href="stk.molecular.topologies.cof.html#cof-assembly"><span class="std std-ref">How the assembly process works for 2D COF topologies.</span></a></li>
<li><a class="reference internal" href="advanced_cage_building.html"><span class="doc">Advanced Cage Building</span></a></li>
<li><a class="reference internal" href="caching.html"><span class="doc">Caching</span></a></li>
<li><a class="reference internal" href="modifying_calculators.html"><span class="doc">Modifying stk Calculators</span></a></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></li>
<li><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></li>
<li><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></li>
</ul>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Lukas Turcani

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>